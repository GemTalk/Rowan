set -e
. defStone.env
export vers="3.2.15"

rm -rf *.log *.out

newExtent -s product/bin/extent0.dbf $GEMSTONE_NAME

$GS_HOME/shared/repos/Rowan/platforms/gemstone/topaz/3.2.15/installRowan $GEMSTONE_NAME

startTopaz $GEMSTONE_NAME -l << EOF

  iferr 1 stk
  iferr 2 stack
  iferr 3 exit

  set user DataCurator p swordfish
  login

	run
	| securityPolicy worldAuthorization newUser |
	worldAuthorization := #read.
	securityPolicy := GsObjectSecurityPolicy new
		ownerAuthorization: #write;
		worldAuthorization: worldAuthorization;
		yourself.
	System commit.
	newUser := AllUsers 
		addNewUserWithId: 'Issue332User'
			password: 'swordfish'
			defaultObjectSecurityPolicy: securityPolicy
			privileges: #(
				  'UserPassword'
				  'SessionAccess'
				  'SessionPriority')
			inGroups: #().
		  securityPolicy owner: newUser.
%
	commit

  logout
	exit
EOF
